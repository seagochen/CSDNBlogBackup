> 这是一个非常重要的知识，我这倒不是说考试会如何关照这个知识点。而是说如果你想进一步深入数据科学的领域，就会在很多论文、模型里发现大量用于评判模型和分析样本关联度特征时，会经常用到协方差的概念。这也是为什么我在上一章节里提到协方差后，在这一章里还会做一点补充说明的原因。

@[toc]

# 关于协方差的一个实际生活例子

首先回顾一下协方差的公式

$$Cov(X, Y) = (X - E(X))(Y - E(Y))$$

及其相关系数

$$\rho = \frac{Cov(X, Y)}{ \sqrt{D(X)} \sqrt{D(Y)}}$$

以及数据关联特征

![在这里插入图片描述](https://img-blog.csdnimg.cn/13c6d571a45a44edaa3e102511b92e15.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=,size_16,color_FFFFFF,t_70#pic_center)

我们这里举个例子，说明协方差到底是来做什么的。

比方说，在银行风控系统中，抵押人可能有这么一些数据指标，比如说年龄、性别、学历、抵押资产（固定资产、现金、证券期票、跟其他债务人的借据等），你作为一个银行的工作人员，在确保抵押人的资料真实可信的前提下，你如何确定放贷给某个人的资金是安全的，或者大概率是安全的？


你可能需要一些资料帮助你做出这个判断。比如说银行历史上违约情况进行分析。那么从历史上，贷款人的学历，有博士、硕士、本科、高中以及其他，月收入有>50000，20000 < X < 50000, 10000 <  X < 20000等多个不同档的数据。

比方说，你 令 $X = 学历$, 令$Y = 违约率$。那么我们可以通过协方差计算每一个样本的情况：

$$Cov(X, Y) = [X - \bar{X}] [Y - \bar{Y}]$$

然后把样本计算的结果加起来，$Cov_1 + Cov_2 + \cdots + Cov_n$ 这样可以得到一个值，比如K。

如果 $K > 0$， 说明样本之间成正相关；
如果$K < 0$，说明样本之间成负相关；
如果$K \approx 0$，说明样本之间不相关。

这样，对历史样本进行统计后，你可能就会得到这样一个知识：

> 如果贷款人，有高学历、高收入，高的抵押资产，那么他的违约概率是极低的，而低收入、低学历、低资产的贷款人，违约风险极高。这样，在你审批的时候，就能通过这些条件快速的筛选合适的贷款人，尽最大可能性避免贷款出现违约风险。


# 一些协方差用到的推广公式

$$Cov(X, Y) = Cov(Y, X)$$

$$Cov(X, X) = D(X)$$

$$Cov(X, C) = 0$$

$$Cov(aX, bY) = ab \cdot Cov(X, Y)$$

$$Cov(X_1 + X_2, Y) = Cov(X_1, Y) + Cov(X_2 , Y)$$

$$Cov(X,Y)=E(XY)−E(X)E(Y)$$


# 做点题吧
>  设X， Y为随机变量，D(X) = 25, D(Y) = 16，Cov(X, Y) = 8，则 $\rho = ？$

**解：**

$$\rho = \frac{Cov(X, Y)}{\sqrt{D(X) \sqrt{D(Y)}}} = \frac{8}{\sqrt{25} \sqrt{16}} = \frac{2}{5}$$

----

> 已知二元离散型随机变量 $(X, Y)$ 的联合分布如下：

X\Y |  -1 | 1 | 2 
----|---|---|---
-1   | 0.1  | 0.2 | 0.3
2   | 0.2  | 0.1 | 0.1
> (1) X和Y的边缘分布律
> (2) X和Y的相关系数

**解（1）** 根据我们之前对于离散型二维随机变量的知识点，可以知道

X | -1 |  2
--|---|----
P |  0.6 | 0.4

Y | -1 | 1  | 2
--|---|---|---
P | 0.3 | 0.3 | 0.4


**解（2）** X和Y的相关系数，最重要的就是求解出D和E分别是多少。解题方式有两种，第一种是一个一个的算，但这样比较耗费时间，第二种就是直接带入公式求解，我们选择第二种。

相关系数方程是 $\rho = \frac{Cov(X, Y)}{ \sqrt{D(X)} \sqrt{D(Y)}}$

从上表，我们可以直接得到：

$$E(X) = -1 \times 0.6 + 2 \times 0.4 = 0.2$$
$$E(X^2) = (-1)^2 \times 0.6 + 2^2 \times 0.4 = 2.2$$
$$D(X) = E(X^2) - E^2(X) = 2.2 - 0.04 = 2.16$$

然后对于Y来说，同样可以：

$$E(Y) = -1 \times 0.3 + 1 \times 0.3 + 2 \times 0.4 = 0.8$$
$$E(Y^2) = (-1)^2 \times 0.3 + 1^2 \times 0.3 + 2^2 \times 0.4 = 2.2$$
$$D(Y) = E(Y^2) - E^2(Y) = 2.2 - 0.64 = 1.56$$

此外：

$$Cov(X, Y) = E(XY) - E(X)E(Y)$$ 而对于E(XY)来说，你可以令XY = Z，所以对于表来说，就可以变成

Z  |  Z(-1, -1) | Z(-1, 1) | Z(-1,2)  | Z(2, -1) | Z(2, 1) | Z(2, 2)
---|----------|--------|--------|---------|--------|--------
P  | 0.1           | 0.2       | 0.3        | 0.2         | 0.1       | 0.1

由于Z = X Y，所以

E(Z) = -0.5

那么 

$$\rho = \frac{-05 - 0.2 \times 0.8}{\sqrt{2.16} \sqrt{1.56} }$$

用计算器算一算，就可以得到：-0.3595
