> 在《浅谈傅里叶 4》里，我引入了卷积的概念来简要的解释了傅里叶的改进方法——短时傅里叶。它类似一种滑动的滤波器，只不过与我们熟知的与对空间滤波、频域滤波不同，这是一个类似时域滤波的滤波器，而我们这节要回到短时傅里叶的数学表达式， 由公式 $STFT(t, f) = \int [f(t) \cdot \omega (t - t^*)] \cdot e ^{-2\pi ikt} dt$ 出发，进一步详细讨论短时傅里叶的优缺点。

# 什么是卷积（Convolution）

前面提到了，短时傅里叶是一种类似卷积的操作，这里我将简要的提一下卷积的概念，尽管我可能在以后的文章里会详细的介绍卷积的概念，不过这里作为一个简要的介绍引入这个重要的数学概念是非常必要的。

首先回到一般的空间滤波的概念。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201213143831414.gif#pic_center)

比如说，对于计算平均数的空间滤波来说，它有一个核函数，这个函数可以是3X3，也可以是其他大小，这个具体取决于你的具体应用。，然后我们把这个核函数，滑动的在原数据集上依次的对数据进行处理，并在新的相同维度的矩阵中，对应的位置上填写具体的数值。

上图中，你会注意到有一个红色的方框，它在“滑动的处理”原始数据，所以这里引入了另外一个重要概念**滑动**。而卷积呢，你就可以理解为有一个核函数，通过滑动的方式，依次对原始函数进行处理的过程。

用一个基本公式可以表示这个过程，就是 
$$
I_o = I_i  \bigodot f_s
$$

其中 $I_i$ 指代的是原始数据集，而 $\bigodot$ 可以理解为某种元素积的函数，而 $f_s$ 则是具体的“掩码”函数，那么如果用连续过程进行表示，这个就变成了下面这个卷积公式：

$$
F(x) = \int f(\tau)g(x-\tau) d\tau
$$

而短时傅里叶公式呢：

$$STFT(\tau, f) = \int [f(\tau) \cdot \omega (\tau - t^*)] \cdot e ^{-2\pi i k \tau} d \tau$$

再回到短时傅里叶函数，你看看是不是很相似？区别只不过在于卷积有一个对 $g(\tau)$ 来说所谓“旋转”的过程。至于为什么有这个区别，以后有机会的时候再说。
 
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210211111545583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=,size_16,color_FFFFFF,t_70#pic_center)



# 短时傅里叶方法的缺陷

在介绍了傅里叶方法的数学推导，并且引入了傅里叶方法对于时频信号分析的改进技术——短时傅里叶。任何强大有力的工具都有它的适用性，也就是傅里叶虽然有精确的频率信息，但是不包含各频率出现的时间信息。于是我们改进了傅里叶方法，并且引入了短时傅里叶。

短时傅里叶确实一定程度上解决了傅里叶缺失信号频率出现的时间问题，但是也引来了另外一个问题，那就是测不准问题。用个通俗的例子来举例，就是用尺子去测量$\pi, \sqrt{2}$，这类尺子无论多小的单位，都无法准确测量的实数，当然，这个举例不一定正确。

> 海森堡于1927年提出，这个理论是说，你不可能同时知道一个粒子的位置和它的速度，粒子位置的不确定性，必然大于或等于普朗克常数（Planck constant）除于4$\pi$，这表明微观世界的粒子行为与宏观物质很不一样。此外，不确定原理涉及很多深刻的哲学问题，用海森堡自己的话说：“在因果律的陈述中，即‘若确切地知道现在，就能预见未来’，所得出的并不是结论，而是前提。我们不能知道现在的所有细节，是一种原则性的事情。”

对于信号处理来说，更为准确的说法是对于给定信号来说，我们无法知道该信号中确切包含的频率与频率出现的时间，以及关联频率的范围，所以我们只能假定某种频率会出现，用某种方法去近似的测量它。

对于短时傅里叶方法，就存在这样的问题，我们无法知道某种频率一定出现的时间位置，所以窗函数的跨度（时间T）就非常难设计，而且，**因为高频信号在时域范围有较好的体现，而低频信号在频域范围有较好的体现**；观测高频信号，我们需要用较窄的跨度去测量它，但是对于低频信号则需要较长的跨度去测量它，而实际的信号又是动态的，所以使用短时傅里叶方法会经常出现测不准信号的情况。

我们用图来说明：

![这里写图片描述](https://img-blog.csdn.net/20180713120421411?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BvaXNvbmNocnk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

由于短时傅里叶的观察窗口大小是确定的，平移时间间隔是确定的，所以它的精度范围也是确定的，如右图所示。当某时刻$T_0$出现了某种低频信号，而此时傅里叶窗口的大小不够大，那么就会导致对这个低频信号的测量失败，在对应的频谱图上就不能有较好的体现。

那么，如果我们换个思路，比如动态的调整窗大小，或许我们可以解决，或者把“测不准”带来的影响降低到最小。不过这就引入了小波分析了，属于另外一个范畴，这里就不展开讨论。

综上所述，使用傅里叶分析，可以有效的得出原始信号中包含的频率范围，但是要求处理的数据是“已经固定了的”，并且由于处理时间的滞后性，不适用于实时处理。而它的改进办法，有通过在时间轴上“滑动观察时间窗口”的方法，使傅里叶分析可以用于实时处理，但是对于数据信号要预先有所了解，并设计合适大小的观察窗，这对于未知信号不是友好，这通常意味着使用者需要反复调试参数，以确定最佳大小。

尽管有改进的动态滑窗，或者自适应的所谓的小波分析方法（Wavelet Transform），但是我们可以从自己的工作经历预判，这种自适应方法带来的一定是性能的下降。